<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{/fragments/header :: mainHeader}"></head>

<body>

<link rel="stylesheet" th:href="@{/vendor/summernote/summernote-lite.css}">


<div th:if = "${session.user != null}">

    <div th:if="${session.user.state == 1}">
        <div th:replace="~{/fragments/navUser :: naviUser}"></div>
    </div>

    <div th:if="${session.user.state == 2}">
        <div th:replace="~{/fragments/navHelper :: naviHelper}"></div>
    </div>

    <div th:if="${session.user.state == 0}">
        <div th:replace="~{/fragments/navManager :: naviManager}"></div>
    </div>

</div>

<form th:action="@{/serviceCenter/postCusWrite}" method="post">

    <section class="section-hero overlay inner-page bg-image" style="background-image: url('images/hero_1.jpg');" id="home-section">
        <div class="container">
            <div class="row">
                <div class="col-md-7">
                    <h1 class="text-white font-weight-bold">문의 남깁니다.</h1>
                    <div class="custom-breadcrumbs">
                        <a href="#">Home</a> <span class="mx-2 slash">/</span>
                        <a href="#">Job</a> <span class="mx-2 slash">/</span>
                        <span class="text-white"><strong>Post a Job</strong></span>
                    </div>
                </div>
            </div>
        </div>
    </section>


    <section class="site-section">
        <div class="container">

            <div class="row align-items-center mb-5">
                <div class="col-lg-8 mb-4 mb-lg-0">
                    <div class="d-flex align-items-center">
                    </div>
                </div>

            </div>
            <div class="row mb-5">
                <div class="col-lg-12">
                    <form class="p-4 p-md-5 border rounded">
                        <h3 class="text-black mb-5 border-bottom pb-2">문의합니다.</h3>

                        <div class="form-group">
                            <label for="title">제목</label>
                            <input type="text" name="cusTitle" class="form-control" id="title" />
                        </div>


                        <label for="title">내용</label>
                        <textarea class="summernote" id="editordata" th:name="cusContent" th:required="true"></textarea>


                        <div class="form-group">
                            <label for="check1">공개 여부</label>
                            <input class="selectpicker border rounded" data-style="btn-black" data-width="100%" data-live-search="true" type="radio" name="secretBoard" id="check1" value="n"/>공개
                            <input class="selectpicker border rounded" data-style="btn-black" data-width="100%" data-live-search="true" type="radio" name="secretBoard" id="check2" checked value="y"/>비공개
                        </div>
                        <div class="form-group" id="inputPass">
                            <label for="job-title">비밀번호</label>
                            <input type="password" name="passwordBoard" class="form-control" id="job-title" />
                        </div>

                        <input type="hidden" name="cusWriter" th:value="${session.user.id}"/>
                    </form>
                </div>
            </div>

            <div class="row align-items-center mb-5">
                <div class="col-lg-4 ml-auto">
                    <div class="row">
                        <div class="col-6">
                            <button type="submit" id="submit_btn" class="btn btn-primary btn-md btn-file">저장</button>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </section>
</form>



<footer th:replace="~{/fragments/footer :: mainFooter}"></footer>

<script th:src="@{/vendor/summernote/summernote-lite.js}"></script>
<script th:src="@{/vendor/summernote/lang/summernote-ko-KR.js}"></script>

<script>

    //summerNote
    $('.summernote').summernote({
        height: 500,
        lang: "ko-KR",
        focus: true,
        toolbar: [
            // 글꼴 설정
            ['fontname', ['fontname']],
            // 글자 크기 설정
            ['fontsize', ['fontsize']],
            // 굵기, 기울임꼴, 밑줄,취소 선, 서식지우기
            ['style', ['bold', 'italic', 'underline', 'strikethrough', 'clear']],
            // 글자색
            ['color', ['forecolor', 'color']],
            // 표만들기
            ['table', ['table']],
            // 글머리 기호, 번호매기기, 문단정렬
            ['para', ['ul', 'ol', 'paragraph']],
            // 줄간격
            ['height', ['height']],
            // 그림첨부, 링크만들기, 동영상첨부
            ['insert', ['picture', 'link', 'video']],
            // 코드보기, 확대해서보기, 도움말
            ['view', ['codeview', 'fullscreen', 'help']]
        ],
        // 추가한 글꼴
        fontNames: ['Arial', 'Arial Black', 'Comic Sans MS', 'Courier New', '맑은 고딕', '궁서', '굴림체', '굴림', '돋음체', '바탕체'],
        // 추가한 폰트사이즈
        fontSizes: ['8', '9', '10', '11', '12', '14', '16', '18', '20', '22', '24', '28', '30', '36', '50', '72'],
        callbacks: {

            onMediaDelete: function (files, editor, welEditable) {
                for (var i = files.length - 1; i >= 0; i--) {
                    deleteFile($(files[i]).attr("src"), this);
                }
            },

            onImageUpload: function (files, editor, welEditable) {
                // 파일 업로드(다중업로드를 위해 반복문 사용)
                for (var i = files.length - 1; i >= 0; i--) {
                    sendFile(files[i], this);
                }
            }
        }
    });
    // summernote 에디터 설정 끝

    // 양식에서 파일을 삭제했을 때, 서버의 파일과 DB에 파일을 삭제하기 위한 ajax
    function deleteFile(filePathName, el) {
        var form_data = new FormData();
        form_data.append('filePathName', filePathName);
        $.ajax({
            data: form_data,
            type: "POST",
            url: '/auction/fileDelete',
            cache: false,
            contentType: false,
            processData: false,
            success: function (data) {
                if (thumbnail.attr("value") != null) {
                    thumbnail.attr(
                        "value", null
                    )
                }
                console.log(data.removedFileName)
                const itemToFind = tempFileList.find(function (item) {
                    return item.savedFileName === data.removedFileName
                });
                const idx = tempFileList.indexOf(itemToFind);
                if (idx > -1) tempFileList.splice(idx, 1);
                console.log(tempFileList);
            }
        });
    }

    // 끝

    // 양식에 파일을 올렸을 때, 서버와 DB에 파일을 저장할 ajax
    function sendFile(file, el) {
        var form_data = new FormData();
        form_data.append('file', file);
        form_data.append('postNo', $("#postNo").val());
        $.ajax({
            data: form_data,
            type: "POST",
            url: '/auction/fileUpload',
            cache: false,
            contentType: false,
            enctype: 'multipart/form-data',
            processData: false,
            success: function (data) {
                if (thumbnail.attr("value") == null) {
                    thumbnail.attr("value", data.savedFileName);
                }
                $(el).summernote('editor.insertImage', data.url);
                tempFileList.push({
                    savedFileName: data.savedFileName,
                    originalFileName: data.originalFileName
                });
            }
        });
    }

</script>
</body>
</html>